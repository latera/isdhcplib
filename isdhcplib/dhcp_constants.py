# isdhcplib
# Copyright (c) 2013 Alexander V. Ignatyev <ialx84@ya.ru>
# Inspired by pydhcplib by Mathieu Ignacio -- mignacio@april.org
#
# This file is part of isdhcplib.
# Isdhcplib is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program. If not, see <http://www.gnu.org/licenses/>.


MAGIC_COOKIE = [99,130,83,99]

HEAD_OPTIONS = (53, )
TAIL_OPTIONS = (82, )

DHCP_FIELDS = {
    'op':     (0, 1, 'char'),
    'htype':  (1, 1, 'char'),   # RFC 1340 sec "ADDRESS RESOLUTION PROTOCOL PARAMETERS"
    'hlen':   (2, 1, 'char'),
    'hops':   (3, 1, 'char'),
    'xid':    (4, 4, '32-bits'),
    'secs':   (8, 2, '16-bits'),
    'flags':  (10, 2, 'char+'),
    'ciaddr': (12, 4, 'ipv4'),
    'yiaddr': (16, 4, 'ipv4'),
    'siaddr': (20, 4, 'ipv4'),
    'giaddr': (24, 4, 'ipv4'),
    'chaddr': (28, 16, 'char+'),
    'sname':  (44, 64, 'string'),
    'file':   (108, 128, 'string')
}

DHCP_FIELDS_NAMES = {
    'op': {0: 'ERROR_UNDEF', 1: 'BOOTREQUEST', 2: 'BOOTREPLY'},
    'dhcp_message_type': {
        0: 'ERROR_UNDEF', 1: 'DHCP_DISCOVER', 2: 'DHCP_OFFER',
        3: 'DHCP_REQUEST', 4: 'DHCP_DECLINE', 5: 'DHCP_ACK',
        6: 'DHCP_NACK', 7: 'DHCP_RELEASE', 8: 'DHCP_INFORM'
    },
}

# See http://www.iana.org/assignments/bootp-dhcp-parameters
# FIXME : verify all ipv4+ options, somes are 32 bits...

DHCP_OPTIONS = {
    0: ('pad', 'none'),
    1: ('subnet_mask', 'ipv4'),
    2: ('time_offset', 'ipv4'),
    3: ('router', 'ipv4+'),
    4: ('time_server', 'ipv4+'),
    5: ('name_server', 'ipv4+'),
    6: ('domain_name_server', 'ipv4+'),
    7: ('log_server', 'ipv4+'),
    8: ('cookie_server', 'ipv4+'),
    9: ('lpr_server', 'ipv4+'),
    10: ('impress_server', 'ipv4+'),
    11: ('resource_location_server', 'ipv4+'),
    12: ('host_name', 'string'),
    13: ('boot_file', '16-bits'),
    14: ('merit_dump_file', 'string'),
    15: ('domain_name', 'string'),
    16: ('swap_server', 'ipv4'),
    17: ('root_path', 'string'),
    18: ('extensions_path', 'string'),
    19: ('ip_forwarding', 'bool'),
    20: ('nonlocal_source_rooting', 'bool'),
    21: ('policy_filter', 'ipv4+'),
    22: ('maximum_datagram_reassembly_size', '16-bits'),
    23: ('default_ip_time-to-live', 'char'),
    24: ('path_mtu_aging_timeout', 'ipv4'),
    25: ('path_mtu_table', '16-bits'),
    26: ('interface_mtu', '16-bits'),
    27: ('all_subnets_are_local', 'bool'),
    28: ('broadcast_address', 'ipv4'),
    29: ('perform_mask_discovery', 'bool'),
    30: ('mask_supplier', 'bool'),
    31: ('perform_router_discovery', 'bool'),
    32: ('routeur_solicitation_address', 'ipv4'),
    33: ('static_route', 'ipv4+'),
    34: ('trailer_encapsulation', 'bool'),
    35: ('arp_cache_timeout', '32-bits'),
    36: ('ethernet_encapsulation', 'bool'),
    37: ('tcp_default_ttl', 'char'),
    38: ('tcp_keepalive_interval', '32-bits'),
    39: ('tcp_keepalive_garbage', 'bool'),
    40: ('nis_domain', 'string'),
    41: ('nis_servers', 'ipv4+'),
    42: ('ntp_servers', 'ipv4+'),
    44: ('nbns', 'ipv4+'),
    45: ('nbdd', 'ipv4+'),
    46: ('nb_node_type', 'char'),
    47: ('nb_scope', 'string'),
    48: ('x_window_system_font_server', 'ipv4+'),
    49: ('x_window_system_display_manager', 'ipv4+'),
    50: ('request_ip_address', 'ipv4'),
    51: ('ip_address_lease_time', '32-bits'),
    52: ('overload', 'char'),
    53: ('dhcp_message_type', 'char'),
    54: ('server_identifier', '32-bits'),
    55: ('parameter_request_list', 'char+'),
    56: ('message', 'string'),
    57: ('maximum_dhcp_message_size', '16-bits'),
    58: ('renewal_time_value', '32-bits'),
    59: ('rebinding_time_value', '32-bits'),
    60: ('class_identifier', 'class-identifier'),
    61: ('client_identifier', 'identifier'),
    62: ('netware_ip_domain_name', 'string'),
    63: ('netware_ip_sub_options', 'RFC2242'),
    64: ('nis+_domain', 'string'),
    65: ('nis+_servers', 'ipv4+'),
    66: ('tftp_server_name', 'string'),
    67: ('bootfile_name', 'string'),
    68: ('mobile_ip_home_agent', 'ipv4'),
    69: ('smtp_servers', 'ipv4+'),
    70: ('pop_servers', 'ipv4+'),
    71: ('nntp_servers', 'ipv4+'),
    72: ('default_www_server', 'ipv4+'),
    73: ('default_finger_server', 'ipv4+'),
    74: ('default_irc_server', 'ipv4+'),
    75: ('streettalk_server', 'ipv4+'),
    76: ('streettalk_directory_assistance_server', 'ipv4+'),
    77: ('user_class', 'RFC3004'),
    78: ('directory_agent', 'RFC2610'),
    79: ('service_scope', 'RFC2610'),
    80: ('rapid_commit', 'null'),
    81: ('client_fqdn', 'RFC4702'),
    82: ('relay_agent', 'RFC3046'),
    83: ('internet_storage_name_service', 'RFC4174'),
    84: ('84', None),
    85: ('nds_server', 'ipv4+'),
    86: ('nds_tree_name', 'RFC2241'),
    87: ('nds_context', 'RFC2241'),
    88: ('88', None),
    89: ('89', None),
    90: ('authentication', 'RFC3118'),
    91: ('client_last_transaction_time', 'RFC4388'),
    92: ('associated_ip', 'ipv4+'),
    93: ('client_system', None),
    94: ('client_ndi', None),
    95: ('ldap', None),
    97: ('uuid_guid', None),
    98: ('open_group_user_auth', 'string'),
    112: ('netinfo_address', None),
    113: ('netinfo_tag', None),
    114: ('url', None),
    115: (None, None),
    116: ('auto_config', 'char'),
    117: ('name_service_search', 'RFC2937'),
    118: ('subnet_selection', 'ipv4'),
    119: ('domain_search', 'RFC3397'),
    120: ('sip_servers', 'RFC3361'),
    121: ('classless_static_route', 'RFC3442'),
    122: ('cablelabs_client_configuration', None),
    123: ('geoconf', None),
    124: ('vendor_class', None),
    125: ('vendor_specific', None),
    126: ('126', None),
    127: ('127', None),
    128: ('128', None),
    129: ('129', None),
    130: ('130', None),
    131: ('131', None),
    132: ('132', None),
    133: ('133', None),
    134: ('134', None),
    135: ('135', None),
    136: ('136', None),
    137: ('137', None),
    138: ('138', None),
    139: ('139', None),
    140: ('140', None),
    141: ('141', None),
    142: ('142', None),
    143: ('143', None),
    144: ('144', None),
    145: ('145', None),
    146: ('146', None),
    147: ('147', None),
    148: ('148', None),
    149: ('149', None),
    150: ('150', None),
    151: ('151', None),
    152: ('152', None),
    153: ('153', None),
    154: ('154', None),
    155: ('155', None),
    156: ('156', None),
    157: ('157', None),
    158: ('158', None),
    159: ('159', None),
    160: ('160', None),
    161: ('161', None),
    162: ('162', None),
    163: ('163', None),
    164: ('164', None),
    165: ('165', None),
    166: ('166', None),
    167: ('167', None),
    168: ('168', None),
    169: ('169', None),
    170: ('170', None),
    171: ('171', None),
    172: ('172', None),
    173: ('173', None),
    174: ('174', None),
    175: ('175', None),
    176: ('176', None),
    177: ('177', None),
    178: ('178', None),
    179: ('179', None),
    180: ('180', None),
    181: ('181', None),
    182: ('182', None),
    183: ('183', None),
    184: ('184', None),
    185: ('185', None),
    186: ('186', None),
    187: ('187', None),
    188: ('188', None),
    189: ('189', None),
    190: ('190', None),
    191: ('191', None),
    192: ('192', None),
    193: ('193', None),
    194: ('194', None),
    195: ('195', None),
    196: ('196', None),
    197: ('197', None),
    198: ('198', None),
    199: ('199', None),
    200: ('200', None),
    201: ('201', None),
    202: ('202', None),
    203: ('203', None),
    204: ('204', None),
    205: ('205', None),
    206: ('206', None),
    207: ('207', None),
    208: ('208', None),
    209: ('209', None),
    210: ('210', None),
    211: ('211', None),
    212: ('212', None),
    213: ('213', None),
    214: ('214', None),
    215: ('215', None),
    216: ('216', None),
    217: ('217', None),
    218: ('218', None),
    219: ('219', None),
    220: ('220', None),
    221: ('221', None),
    222: ('222', None),
    223: ('223', None),
    224: ('224', None),
    225: ('225', None),
    226: ('226', None),
    227: ('227', None),
    228: ('228', None),
    229: ('229', None),
    230: ('230', None),
    231: ('231', None),
    232: ('232', None),
    233: ('233', None),
    234: ('234', None),
    235: ('235', None),
    236: ('236', None),
    237: ('237', None),
    238: ('238', None),
    239: ('239', None),
    240: ('240', None),
    241: ('241', None),
    242: ('242', None),
    243: ('243', None),
    244: ('244', None),
    245: ('245', None),
    246: ('246', None),
    247: ('247', None),
    248: ('248', None),
    249: ('249', 'RFC3442'),
    250: ('250', None),
    251: ('251', None),
    252: ('252', 'string'),
    253: ('253', None),
    254: ('254', None),
    255: ('end', None)
}

DHCP_OPTION_NUM = {
    'pad': 0,

    # Vendor Extension
    'subnet_mask': 1, 'time_offset': 2,
    'router': 3, 'time_server': 4, 'name_server': 5,
    'domain_name_server': 6, 'log_server': 7,
    'cookie_server': 8, 'lpr_server': 9,
    'impress_server': 10, 'resource_location_server': 11,
    'host_name': 12, 'boot_file': 13, 'merit_dump_file': 14,
    'domain_name': 15, 'swap_server': 16, 'root_path': 17,
    'extensions_path': 18,

    # IP layer parameters per host
    'ip_forwarding': 19, 'nonlocal_source_rooting': 20,
    'policy_filter': 21, 'maximum_datagram_reassembly_size': 22,
    'default_ip_time-to-live': 23, 'path_mtu_aging_timeout': 24,
    'path_mtu_table': 25,

    # IP layer parameters per interface
    'interface_mtu': 26, 'all_subnets_are_local': 27,
    'broadcast_address': 28, 'perform_mask_discovery': 29,
    'mask_supplier': 30, 'perform_router_discovery': 31,
    'routeur_solicitation_address': 32, 'static_route': 33,

    # link layer parameters per interface
    'trailer_encapsulation': 34, 'arp_cache_timeout': 35,
    'ethernet_encapsulation': 36,

    # TCP parameters
    'tcp_default_ttl': 37, 'tcp_keepalive_interval': 38,
    'tcp_keepalive_garbage': 39,

    # Applications and service parameters
    'nis_domain': 40,
    'nis_servers': 41,
    'ntp_servers': 42,
    # 'vendor_specific': 43,
    'nbns': 44,
    'nbdd': 45, 'nb_node_type': 46,
    'nb_scope': 47, 'x_window_system_font_server': 48,
    'x_window_system_display_manager': 49,

    # DHCP extensions
    'request_ip_address': 50,
    'ip_address_lease_time': 51,
    'overload': 52,
    'dhcp_message_type': 53,
    'server_identifier': 54,
    'parameter_request_list': 55,
    'message': 56,
    'maximum_dhcp_message_size': 57,
    'renewal_time_value': 58,
    'rebinding_time_value': 59,
    # 'vendor_class': 60,
    'client_identifier': 61,

    # Add from RFC 2132 
    'netware_ip_domain_name': 62,
    'netware_ip_sub_options': 63,

    'nis+_domain': 64,
    'nis+_servers': 65,
    'tftp_server_name': 66,
    'bootfile_name': 67,
    'mobile_ip_home_agent': 68,
    'smtp_servers': 69,
    'pop_servers': 70,
    'nntp_servers': 71,
    'default_www_server': 72,
    'default_finger_server': 73,
    'default_irc_server': 74,
    'streettalk_server': 75,
    'streettalk_directory_assistance_server': 76,

    'user_class': 77,
    'directory_agent': 78,
    'service_scope': 79,
    'rapid_commit': 80,

    'client_fqdn': 81,
    'relay_agent': 82,
    'internet_storage_name_service': 83,
    '84': 84,
    'nds_server': 85,
    'nds_tree_name': 86,
    'nds_context': 87,
    '88': 88,
    '89': 89,
    'authentication': 90,
    'client_last_transaction_time': 91,
    'associated_ip': 92,
    'client_system': 93,
    'client_ndi': 94,
    'ldap': 95,
    None: 96,
    'uuid_guid': 97,
    'open_group_user_auth': 98,
    None: 99,
    None: 100,
    None: 101,
    None: 102,
    None: 103,
    None: 104,
    None: 105,
    None: 106,
    None: 107,
    None: 108,
    None: 109,
    None: 110,
    None: 111,
    'netinfo_address': 112,
    'netinfo_tag': 113,
    'url': 114,
    None: 115,
    'auto_config': 116,
    'name_service_search': 117,
    'subnet_selection': 118,
    'domain_search': 119,
    'sip_servers': 120,
    'classless_static_route': 121,
    'cablelabs_client_configuration': 122,
    'geoconf': 123,
    'vendor_class': 124,
    'vendor_specific': 125,
    '126': 126, '127': 127, '128': 128, '129': 129,
    '130': 130, '131': 131, '132': 132, '133': 133,
    '134': 134, '135': 135, '136': 136, '137': 137,
    '138': 138, '139': 139, '140': 140, '141': 141,
    '142': 142, '143': 143, '144': 144, '145': 145,
    '146': 146, '147': 147, '148': 148, '149': 149,
    '150': 150, '151': 151, '152': 152, '153': 153,
    '154': 154, '155': 155, '156': 156, '157': 157,
    '158': 158, '159': 159, '160': 160, '161': 161,
    '162': 162, '163': 163, '164': 164, '165': 165,
    '166': 166, '167': 167, '168': 168, '169': 169,
    '170': 170, '171': 171, '172': 172, '173': 173,
    '174': 174, '175': 175, '176': 176, '177': 177,
    '178': 178, '179': 179, '180': 180, '181': 181,
    '182': 182, '183': 183, '184': 184, '185': 185,
    '186': 186, '187': 187, '188': 188, '189': 189,
    '190': 190, '191': 191, '192': 192, '193': 193,
    '194': 194, '195': 195, '196': 196, '197': 197,
    '198': 198, '199': 199, '200': 200, '201': 201,
    '202': 202, '203': 203, '204': 204, '205': 205,
    '206': 206, '207': 207, '208': 208, '209': 209,
    '210': 210, '211': 211, '212': 212, '213': 213,
    '214': 214, '215': 215, '216': 216, '217': 217,
    '218': 218, '219': 219, '220': 220, '221': 221,
    '222': 222, '223': 223, '224': 224, '225': 225,
    '226': 226, '227': 227, '228': 228, '229': 229,
    '230': 230, '231': 231, '232': 232, '233': 233,
    '234': 234, '235': 235, '236': 236, '237': 237,
    '238': 238, '239': 239, '240': 240, '241': 241,
    '242': 242, '243': 243, '244': 244, '245': 245,
    '246': 246, '247': 247, '248': 248, '249': 249,
    '250': 250, '251': 251, '252': 252, '253': 253,
    '254': 254, 'end': 255
}
